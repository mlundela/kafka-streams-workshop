<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Audiobooks</title>
	<link href="main.css" rel="stylesheet">
</head>
<body>

<section class="section">
	<div class="container">
		<h1 class="title">Audiobooks<span style="color: #00d1b2">4</span>You</h1>
		<p class="subtitle">
			Find your next great listen!
		</p>
	</div>
</section>

<!-- Search bar -->
<section class="search-bar">
	<div class="field has-addons">
		<div class="control" style="width: 100%">
			<label>
				<input id="search-bar" class="input" type="text" placeholder="Search books">
			</label>
		</div>
		<div class="control">
			<a class="button is-primary">
				Search
			</a>
		</div>
	</div>
</section>

<!-- Results -->
<section id="search-results">
</section>

<template id="book-template">
	<div class="card">
		<div class="card-content">
			<div class="media">
				<div class="media-left">
					<figure class="image is-48x48">
						<img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
					</figure>
				</div>
				<div class="media-content">
					<p class="title is-4">John Smith</p>
					<p class="subtitle is-6">@johnsmith</p>
				</div>
			</div>

			<div class="content">
				Lorem ipsum dolor sit amet, consectetur adipiscing elit.
				Phasellus nec iaculis mauris. <a>@bulmaio</a>.
			</div>
		</div>
	</div>
</template>


<script type="application/javascript">

	const searchBar = document.querySelector('#search-bar')
	const searchResults = document.querySelector('#search-results')
	const cardTemplate = document.querySelector('#book-template')

	function clearBooks () {
		searchResults.innerHTML = ''
	}

	function addBook ({title, author, description}) {
		const card = document.importNode(cardTemplate.content, true)
		card.querySelector('.title').innerText = title
		card.querySelector('.subtitle').innerText = author
		card.querySelector('.content').innerText = description
		searchResults.appendChild(card)
	}

	searchBar.addEventListener('change', async (event) => {
		clearBooks()
		const query = event.target.value
		const raw = await fetch(`/search?q=${query}`)
		const books = await raw.json()
		for (let book of books) {
			addBook(book._source)
		}
	})
</script>

</body>
</html>
